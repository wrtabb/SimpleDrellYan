
vector<TString> file_data = {
	"output_data/saveFile_MuMu_SingleMuon_Run2016B.root",           // 0
	"output_data/saveFile_MuMu_SingleMuon_Run2016C.root",           // 1
	"output_data/saveFile_MuMu_SingleMuon_Run2016D.root",           // 2
	"output_data/saveFile_MuMu_SingleMuon_Run2016E.root",           // 3
	"output_data/saveFile_MuMu_SingleMuon_Run2016F.root",           // 4
	"output_data/saveFile_MuMu_SingleMuon_Run2016G.root",           // 5
	"output_data/saveFile_MuMu_SingleMuon_Run2016Hver2.root",       // 6
	"output_data/saveFile_MuMu_SingleMuon_Run2016Hver3.root"       // 7
};

vector<TString> file_diboson = {
	"output_data/saveFile_MuMu_WW.root",
	"output_data/saveFile_MuMu_WZ.root",
	"output_data/saveFile_MuMu_ZZ.root"
};

vector<TString> file_taus = {
	"output_data/saveFile_MuMu_DYLL_M10to50_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M50to100_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M100to200_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M200to400_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M400to500_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M500to700_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M700to800_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M800to1000_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M1000to1500_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M1500to2000_TauTau.root",
	"output_data/saveFile_MuMu_DYLL_M2000to3000_TauTau.root"
};

vector<TString> file_DYLL = {
	"output_data/saveFile_MuMu_DYLL_M10to50_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M50to100_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M100to200_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M200to400_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M400to500_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M500to700_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M700to800_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M800to1000_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M1000to1500_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M1500to2000_MuMu.root",
	"output_data/saveFile_MuMu_DYLL_M2000to3000_MuMu.root"
};

vector<TString> file_top = {
	"output_data/saveFile_MuMu_ST_tW.root",
	"output_data/saveFile_MuMu_ST_tbarW.root",
	"output_data/saveFile_MuMu_ttbar_M0to700.root",
	"output_data/saveFile_MuMu_ttbar_M700to1000.root",
	"output_data/saveFile_MuMu_ttbar_M1000toInf.root"
};

vector<TString> file_Fake = {
	"output_data/saveFile_MuMu_WJetsToLNu_amcatnlo.root"
};

vector<TString> hist_data = {
	"SingleMuon_Run2016B",           // 0
	"SingleMuon_Run2016C",           // 1
	"SingleMuon_Run2016D",           // 2
	"SingleMuon_Run2016E",           // 3
	"SingleMuon_Run2016F",           // 4
	"SingleMuon_Run2016G",           // 5
	"SingleMuon_Run2016Hver2",       // 6
	"SingleMuon_Run2016Hver3"       // 7
};
vector<TString> hist_DYLL = {
        "DYLL_M10to50_MuMu",              // 8
        "DYLL_M50to100_MuMu",             // 9
        "DYLL_M100to200_MuMu",            // 10
        "DYLL_M200to400_MuMu",            // 11
        "DYLL_M400to500_MuMu",            // 12
        "DYLL_M500to700_MuMu",            // 13
        "DYLL_M700to800_MuMu",            // 14
        "DYLL_M800to1000_MuMu",           // 15
        "DYLL_M1000to1500_MuMu",          // 16
        "DYLL_M1500to2000_MuMu",          // 17
        "DYLL_M2000to3000_MuMu"           // 18
};

vector<TString> hist_top = {
        "ST_tW",                        // 19
        "ST_tbarW",                     // 20
        "ttbar_truncated_M0To700",      // 21
        "ttbar_M700to1000",             // 22
        "ttbar_M1000toInf"              // 23
};
vector<TString> hist_diboson = {
        "WW",                           // 24
        "WZ",                           // 25
        "ZZ"                            // 26
};
vector<TString> hist_taus = {
        "DYLL_M10to50_TauTau",          // 27
        "DYLL_M50to100_TauTau",         // 28
        "DYLL_M100to200_TauTau",        // 29
        "DYLL_M200to400_TauTau",        // 30
        "DYLL_M400to500_TauTau",        // 31
        "DYLL_M500to700_TauTau",        // 32
        "DYLL_M700to800_TauTau",        // 33
        "DYLL_M800to1000_TauTau",       // 34
        "DYLL_M1000to1500_TauTau",      // 35
        "DYLL_M1500to2000_TauTau",      // 36
        "DYLL_M2000to3000_TauTau"       // 37
};
vector<TString> hist_Fake = {
        "WJetsToLNu_amcatnlo"           // 38   
};

TH1D*GetHistogram(vector<TString> filesvector,vector<TString> histvector,TString variable);

void makeStackPlots()
{
	//gROOT->SetBatch(true);
	TCanvas*c1 = new TCanvas("c1","",0,0,1000,1000);
	c1->SetGrid();
	c1->SetLogx();
	c1->SetLogy();

	TH1D*hMassDYLL = GetHistogram(file_DYLL,hist_DYLL,"InvMass");
	hMassDYLL->SetFillColor(kOrange-2);
	hMassDYLL->SetLineColor(kOrange+3);
	TH1D*hMassTops = GetHistogram(file_top,hist_top,"InvMass");
	hMassTops->SetFillColor(kBlue+2);
	hMassTops->SetLineColor(kBlue+3);
	TH1D*hMassFake = GetHistogram(file_Fake,hist_Fake,"InvMass");
	hMassFake->SetFillColor(kViolet+5);
	hMassFake->SetLineColor(kViolet+3);
	TH1D*hMassDiboson = GetHistogram(file_diboson,hist_diboson,"InvMass");
	hMassDiboson->SetFillColor(kRed+2);
	hMassDiboson->SetLineColor(kRed+4);
	TH1D*hMassTau = GetHistogram(file_taus,hist_taus,"InvMass");
	hMassTau->SetFillColor(kGreen+2);
	hMassTau->SetLineColor(kGreen+3);

	THStack*hStackInvMass = new THStack("hStackInvMass","");
	hStackInvMass->Add(hMassFake);
	hStackInvMass->Add(hMassDiboson);
	hStackInvMass->Add(hMassTau);
	hStackInvMass->Add(hMassTops);
	hStackInvMass->Add(hMassDYLL);
	
	TH1D*hDataInvMass = GetHistogram(file_data,hist_data,"InvMass");
	hDataInvMass->SetMarkerStyle(20);
	hDataInvMass->SetMarkerColor(kBlack);

	hStackInvMass->SetMinimum(0.01);
	hStackInvMass->Draw("hist");
	hDataInvMass->Draw("pe,same");
	hStackInvMass->GetXaxis()->SetTitle("invariant mass [GeV]");
	hStackInvMass->SetTitle("Dimuon invariant mass");
	hStackInvMass->GetXaxis()->SetMoreLogLabels();
	hStackInvMass->GetXaxis()->SetNoExponent();
	c1->Update();

	TLegend*legend = new TLegend(0.65,0.9,0.9,0.75);
	legend->SetTextSize(0.02);
	legend->AddEntry(hDataInvMass,"Data");
	legend->AddEntry(hMassDYLL,"#gamma^{*}/Z #rightarrow e^{-}e^{+}");
	legend->AddEntry(hMassTops,"t#bar{t}+tW+#bar{t}W");
	legend->AddEntry(hMassTau,"#gamma^{*}/Z #rightarrow #tau^{-}#tau^{+}");
	legend->AddEntry(hMassDiboson,"WW,WZ,ZZ");
	legend->AddEntry(hMassFake,"W+Jets");
	legend->Draw("same");

	c1->SaveAs("plots/dataVsMC_MuMu_InvMass.png");

	// Rapidity
	TCanvas*c2 = new TCanvas("c2","",0,0,1000,1000);
	c2->SetGrid();
	c2->SetLogy();

	TH1D*hRapidityDYLL = GetHistogram(file_DYLL,hist_DYLL,"Rapidity");
	hRapidityDYLL->SetFillColor(kOrange-2);
	hRapidityDYLL->SetLineColor(kOrange+3);
	TH1D*hRapidityTops = GetHistogram(file_top,hist_top,"Rapidity");
	hRapidityTops->SetFillColor(kBlue+2);
	hRapidityTops->SetLineColor(kBlue+3);
	TH1D*hRapidityFake = GetHistogram(file_Fake,hist_Fake,"Rapidity");
	hRapidityFake->SetFillColor(kViolet+5);
	hRapidityFake->SetLineColor(kViolet+3);
	TH1D*hRapidityDiboson = GetHistogram(file_diboson,hist_diboson,"Rapidity");
	hRapidityDiboson->SetFillColor(kRed+2);
	hRapidityDiboson->SetLineColor(kRed+4);
	TH1D*hRapidityTau = GetHistogram(file_taus,hist_taus,"Rapidity");
	hRapidityTau->SetFillColor(kGreen+2);
	hRapidityTau->SetLineColor(kGreen+3);

	THStack*hStackRapidity = new THStack("hStackRapidity","");
	hStackRapidity->Add(hRapidityFake);
	hStackRapidity->Add(hRapidityDiboson);
	hStackRapidity->Add(hRapidityTau);
	hStackRapidity->Add(hRapidityTops);
	hStackRapidity->Add(hRapidityDYLL);
	
	TH1D*hRapidityData = GetHistogram(file_data,hist_data,"Rapidity");
	hRapidityData->SetMarkerStyle(20);
	hRapidityData->SetMarkerColor(kBlack);

	hStackRapidity->SetMaximum(10000000);
	hStackRapidity->SetMinimum(0.01);
	hStackRapidity->Draw("hist");
	hRapidityData->Draw("pe,same");
	hStackRapidity->GetXaxis()->SetTitle("Dimuon rapidity");
	hStackRapidity->SetTitle("Dimuon rapidity");
	c2->Update();

	TLegend*legend2 = new TLegend(0.65,0.9,0.9,0.75);
	legend2->SetTextSize(0.02);
	legend2->AddEntry(hRapidityData,"Data");
	legend2->AddEntry(hRapidityDYLL,"#gamma^{*}/Z #rightarrow e^{-}e^{+}");
	legend2->AddEntry(hRapidityTops,"t#bar{t}+tW+#bar{t}W");
	legend2->AddEntry(hRapidityTau,"#gamma^{*}/Z #rightarrow #tau^{-}#tau^{+}");
	legend2->AddEntry(hRapidityDiboson,"WW,WZ,ZZ");
	legend2->AddEntry(hRapidityFake,"W+Jets");
	legend2->Draw("same");

	c2->SaveAs("plots/dataVsMC_MuMu_Rapidity.png");

	// pT Lead
	TCanvas*c3 = new TCanvas("c3","",0,0,1000,1000);
	c3->SetGrid();
	c3->SetLogy();

	TH1D*hPtLeadDYLL = GetHistogram(file_DYLL,hist_DYLL,"PtLead");
	hPtLeadDYLL->SetFillColor(kOrange-2);
	hPtLeadDYLL->SetLineColor(kOrange+3);
	TH1D*hPtLeadTops = GetHistogram(file_top,hist_top,"PtLead");
	hPtLeadTops->SetFillColor(kBlue+2);
	hPtLeadTops->SetLineColor(kBlue+3);
	TH1D*hPtLeadFake = GetHistogram(file_Fake,hist_Fake,"PtLead");
	hPtLeadFake->SetFillColor(kViolet+5);
	hPtLeadFake->SetLineColor(kViolet+3);
	TH1D*hPtLeadDiboson = GetHistogram(file_diboson,hist_diboson,"PtLead");
	hPtLeadDiboson->SetFillColor(kRed+2);
	hPtLeadDiboson->SetLineColor(kRed+4);
	TH1D*hPtLeadTau = GetHistogram(file_taus,hist_taus,"PtLead");
	hPtLeadTau->SetFillColor(kGreen+2);
	hPtLeadTau->SetLineColor(kGreen+3);

	THStack*hStackPtLead = new THStack("hStackPtLead","");
	hStackPtLead->Add(hPtLeadFake);
	hStackPtLead->Add(hPtLeadDiboson);
	hStackPtLead->Add(hPtLeadTau);
	hStackPtLead->Add(hPtLeadTops);
	hStackPtLead->Add(hPtLeadDYLL);
	
	TH1D*hPtLeadData = GetHistogram(file_data,hist_data,"PtLead");
	hPtLeadData->SetMarkerStyle(20);
	hPtLeadData->SetMarkerColor(kBlack);

	hStackPtLead->SetMaximum(10000000);
	hStackPtLead->SetMinimum(0.01);
	hStackPtLead->Draw("hist");
	hPtLeadData->Draw("pe,same");

	hStackPtLead->SetTitle("Leading muon p_{T}");
	hStackPtLead->GetXaxis()->SetTitle("p_{T} [GeV]");
	c3->Update();

	TLegend*legend3 = new TLegend(0.65,0.9,0.9,0.75);
	legend3->SetTextSize(0.02);
	legend3->AddEntry(hPtLeadData,"Data");
	legend3->AddEntry(hPtLeadDYLL,"#gamma^{*}/Z #rightarrow e^{-}e^{+}");
	legend3->AddEntry(hPtLeadTops,"t#bar{t}+tW+#bar{t}W");
	legend3->AddEntry(hPtLeadTau,"#gamma^{*}/Z #rightarrow #tau^{-}#tau^{+}");
	legend3->AddEntry(hPtLeadDiboson,"WW,WZ,ZZ");
	legend3->AddEntry(hPtLeadFake,"W+Jets");
	legend3->Draw("same");

	c3->SaveAs("plots/dataVsMC_MuMu_PtLead.png");

	// pT Sublead
	TCanvas*c4 = new TCanvas("c4","",0,0,1000,1000);
	c4->SetGrid();
	c4->SetLogy();

	TH1D*hPtSubDYLL = GetHistogram(file_DYLL,hist_DYLL,"PtSub");
	hPtSubDYLL->SetFillColor(kOrange-2);
	hPtSubDYLL->SetLineColor(kOrange+3);
	TH1D*hPtSubTops = GetHistogram(file_top,hist_top,"PtSub");
	hPtSubTops->SetFillColor(kBlue+2);
	hPtSubTops->SetLineColor(kBlue+3);
	TH1D*hPtSubFake = GetHistogram(file_Fake,hist_Fake,"PtSub");
	hPtSubFake->SetFillColor(kViolet+5);
	hPtSubFake->SetLineColor(kViolet+3);
	TH1D*hPtSubDiboson = GetHistogram(file_diboson,hist_diboson,"PtSub");
	hPtSubDiboson->SetFillColor(kRed+2);
	hPtSubDiboson->SetLineColor(kRed+4);
	TH1D*hPtSubTau = GetHistogram(file_taus,hist_taus,"PtSub");
	hPtSubTau->SetFillColor(kGreen+2);
	hPtSubTau->SetLineColor(kGreen+3);

	THStack*hStackPtSub = new THStack("hStackPtSub","");
	hStackPtSub->Add(hPtSubFake);
	hStackPtSub->Add(hPtSubDiboson);
	hStackPtSub->Add(hPtSubTau);
	hStackPtSub->Add(hPtSubTops);
	hStackPtSub->Add(hPtSubDYLL);
	
	TH1D*hPtSubData = GetHistogram(file_data,hist_data,"PtSub");
	hPtSubData->SetMarkerStyle(20);
	hPtSubData->SetMarkerColor(kBlack);

	hStackPtSub->SetMaximum(10000000);
	hStackPtSub->SetMinimum(0.01);
	hStackPtSub->Draw("hist");
	hPtSubData->Draw("pe,same");
	hStackPtSub->SetTitle("Sub-leading muon p_{T}");
	hStackPtSub->GetXaxis()->SetTitle("p_{T} [GeV]");
	c4->Update();

	TLegend*legend4 = new TLegend(0.65,0.9,0.9,0.75);
	legend4->SetTextSize(0.02);
	legend4->AddEntry(hPtSubData,"Data");
	legend4->AddEntry(hPtSubDYLL,"#gamma^{*}/Z #rightarrow e^{-}e^{+}");
	legend4->AddEntry(hPtSubTops,"t#bar{t}+tW+#bar{t}W");
	legend4->AddEntry(hPtSubTau,"#gamma^{*}/Z #rightarrow #tau^{-}#tau^{+}");
	legend4->AddEntry(hPtSubDiboson,"WW,WZ,ZZ");
	legend4->AddEntry(hPtSubFake,"W+Jets");
	legend4->Draw("same");

	c4->SaveAs("plots/dataVsMC_MuMu_PtSub.png");
	
}

TH1D*GetHistogram(vector<TString> filesvector,vector<TString> histvector,TString variable)
{
	int nFiles = filesvector.size();
	TString loadFile;
	TString loadHist;
	TFile*file_load[nFiles];
	TH1D*hMassArray[nFiles];
	TH1D*hMass;
	for(int i=0;i<nFiles;i++){
		loadFile = filesvector.at(i);
		loadHist = "hist";
		loadHist += histvector.at(i);
		loadHist += variable;
		cout << "********************************************" << endl;
		cout << "Loading histogram: " << loadHist << endl;
		cout << "From file: " << loadFile << endl; 
		file_load[i] = new TFile(loadFile);
		if(!file_load[i]){
			cout << "ERROR loading file: " << loadFile << endl;
		}
		hMassArray[i] = (TH1D*)file_load[i]->Get(loadHist);
		if(!hMassArray[i]){
			cout << "ERROR loading histogram: " << loadHist << endl;
		}
		cout << "********************************************" << endl;
		cout << endl;
		if(i==0) hMass = (TH1D*)hMassArray[i]->Clone();
		else hMass->Add(hMassArray[i]);
	}// end loop over files

	return hMass;
}

